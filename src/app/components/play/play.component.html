<div class="col">
    <div class="row justify-content-start" *ngIf="!getGameInProgress()">
        <button type="button" class="btn btn-light" (click)="startNewGame();">Start New
            Game</button>
    </div>

    <div *ngIf="getGameInProgress()">

        <div class="row align-items-center">
            <div class="col">
                <div class="row justify-content-start">
                    <button type="button" class="btn btn-light" (click)="startNewGame();">Start
                        New
                        Game</button>
                </div>
            </div>
            <!-- Player 2 -->
            <div class="col-4 bg-light" style="height: 9vh;" *ngIf="getNumberOfPlayers() >= 2"
                [ngStyle]="showAsSelected(1)">
                <div class="row justify-content-around">
                    <div class="col"></div>
                    <div class="col">
                        <!-- Player Name -->
                        <div class="row justify-content-around">
                            {{getPlayers()[1].name}} (Computer)
                        </div>
                    </div>
                    <div class="col">
                        <!-- Toggle Resource Details -->
                        <div class="row justify-content-end">
                            <div [class.pointer]="activePlayer == 1 && !getPlayers()[activePlayer].isAi"
                                [class.text-muted]="showBuyingPowerAsTotal"
                                [class.font-weight-light]="showBuyingPowerAsTotal"
                                (click)="(activePlayer == 1 && !getPlayers()[activePlayer].isAi) ? (showBuyingPowerAsTotal = !showBuyingPowerAsTotal) : {}">
                                Gems ({{getPlayerGemsTotal(1)}}) - Cards ({{getPlayerCardsTotal(1)}}) &nbsp;
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row justify-content-around">
                    <!-- Player points -->
                    <div class="col border-right border-secondary">
                        <h6 class="text-center">Points</h6>
                        <h6 class="text-center">{{getPlayers()[1].points}}</h6>
                    </div>

                    <!-- Held Cards -->

                    <ng-template #popTitleReservedCards>
                        <div class="text-center">Reserved Cards</div>
                    </ng-template>

                    <ng-template #popContentReservedCards>
                        <!-- Show Reserved Cards -->
                        <div *ngFor="let card of getPlayers()[1].heldCards; let i = index">
                            <div class="row">
                                <div class="col"></div>
                                <div class="col-8">
                                    <div class="card" [ngClass]=getTierCardColor(card)
                                        [class.pointer]="activePlayer == 1 && !getPlayers()[activePlayer].isAi"
                                        (click)="(activePlayer == 1 && !getPlayers()[activePlayer].isAi) ? (activePlayerCanAffordCard(card) ? buyCard(card) : showGempyreModal(this.ALERT_TYPE_USER_ERROR, this.ALERT_CAN_NOT_AFFORD_RESERVED_CARD)) : {}"
                                        [ngStyle]=showAsSelected(card)>
                                        <img class="card-img"
                                            style="object-fit: cover; height: 15vh; opacity: .85; background-color: white;"
                                            [src]=getTierCardImage(card.tier) alt="tier{{card.tier}}">
                                        <div class="card-img-overlay">
                                            <div class="d-flex flex-column h-100 justify-content-between" *ngIf="card">
                                                <div class="row justify-content-around bg-light">
                                                    <h4>{{card.points}}</h4>
                                                    <h4>-</h4>
                                                    <h4 [ngStyle]="getCostColor(card.value[0])">
                                                        1
                                                    </h4>
                                                </div>
                                                <div class="row justify-content-around bg-light">
                                                    <h4 class="card-text text-center"
                                                        [ngStyle]="getCostColor(cardCost.key[0])"
                                                        *ngFor="let cardCost of card.cost | keyvalue">
                                                        {{cardCost.value}}</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col"></div>
                            </div>
                            <br *ngIf="i + 1 < getPlayers()[1].heldCards.length">
                        </div>

                    </ng-template>

                    <div class="col border-right border-secondary pointer" id="heldCards" placement="bottom"
                        [ngbPopover]="popContentReservedCards" [popoverTitle]="popTitleReservedCards">
                        <h6 class="text-center">Held</h6>
                        <h6 class="text-center">{{getPlayers()[1].heldCards.length}}</h6>

                    </div>
                    <!-- Player buying power -->
                    <div class="col"
                        [class.pointer]="(activePlayer == 1 && !getPlayers()[activePlayer].isAi) ? (turnAction == ACTION_EXCHANGE_GEMS || turnAction == ACTION_RESERVE_EXCHANGE || (turnAction == ACTION_BUY_CARD && gem == gemTypes[gemTypes.length - 1] && getPlayerGemsByGemType(1, gem) > 0)) : false"
                        *ngFor="let gem of gemTypes">
                        <!-- Gem Title -->
                        <h6 class="text-center" [ngStyle]="getCostColor(gem[0])">{{gem.substring(0, 3)}}</h6>
                        <!-- Gem display -->
                        <h6 class="text-center" [ngStyle]="getCostColor(gem[0])"
                            (click)="(activePlayer == 1 && !getPlayers()[activePlayer].isAi) ? ((turnAction == ACTION_EXCHANGE_GEMS || turnAction == ACTION_RESERVE_EXCHANGE) ? exchangeGem(gem) : 
                        ((turnAction == ACTION_BUY_CARD && gem == gemTypes[gemTypes.length - 1] && getPlayerGemsByGemType(1, gem) > 0) ? startSpendingGold() : {})) : {}">
                            <!-- total -->
                            <div *ngIf="showBuyingPowerAsTotal">
                                {{getPlayerBuyingPowerByGemType(1, gem)}}
                            </div>
                            <!-- gem - card breakdown -->
                            <div *ngIf="!showBuyingPowerAsTotal">
                                {{getPlayerGemsByGemType(1, gem)}} -
                                {{getPlayerCardsByGemType(1, gem)}}
                            </div>
                        </h6>
                    </div>
                </div>

            </div>
            <div class="col"></div>
        </div>

        <br>
        <div class="row">
            <!-- Player 3 -->
            <div class="col-1 d-flex flex-column bg-light justify-content-between" *ngIf="getNumberOfPlayers() >= 3"
                [ngStyle]="showAsSelected(2)">

                <div class="row justify-content-center">
                    {{getPlayers()[2].name}} (Computer)
                </div>

                <!-- Player points -->
                <div class="row justify-content-center">
                    <div class="col"></div>
                    <div class="col border-bottom border-secondary">
                        <h6 class="text-center">Points</h6>
                        <h6 class="text-center">{{getPlayers()[2].points}}</h6>
                    </div>
                    <div class="col"></div>
                </div>

                <!-- Held Cards -->
                <div class="row justify-content-center">
                    <ng-template #popTitleReservedCards>
                        <div class="text-center">Reserved Cards</div>
                    </ng-template>

                    <ng-template #popContentReservedCards>
                        <!-- Show Reserved Cards -->
                        <div *ngFor="let card of getPlayers()[2].heldCards; let i = index">
                            <div class="row">
                                <div class="col"></div>
                                <div class="col-8">
                                    <div class="card" [ngClass]=getTierCardColor(card)
                                        [class.pointer]="activePlayer == 2 && !getPlayers()[activePlayer].isAi"
                                        (click)="(activePlayer == 2 && !getPlayers()[activePlayer].isAi) ? (activePlayerCanAffordCard(card) ? buyCard(card) : showGempyreModal(this.ALERT_TYPE_USER_ERROR, this.ALERT_CAN_NOT_AFFORD_RESERVED_CARD)) : {}"
                                        [ngStyle]=showAsSelected(card)>
                                        <img class="card-img"
                                            style="object-fit: cover; height: 15vh; opacity: .85; background-color: white;"
                                            [src]=getTierCardImage(card.tier) alt="tier{{card.tier}}">
                                        <div class="card-img-overlay">
                                            <div class="d-flex flex-column h-100 justify-content-between" *ngIf="card">
                                                <div class="row justify-content-around bg-light">
                                                    <h4>{{card.points}}</h4>
                                                    <h4>-</h4>
                                                    <h4 [ngStyle]="getCostColor(card.value[0])">
                                                        1
                                                    </h4>
                                                </div>
                                                <div class="row justify-content-around bg-light">
                                                    <h4 class="card-text text-center"
                                                        [ngStyle]="getCostColor(cardCost.key[0])"
                                                        *ngFor="let cardCost of card.cost | keyvalue">
                                                        {{cardCost.value}}</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col"></div>
                            </div>
                            <br *ngIf="i + 1 < getPlayers()[2].heldCards.length">
                        </div>

                    </ng-template>

                    <div class="col"></div>
                    <div class="col border-bottom border-secondary pointer" id="heldCards" placement="right"
                        [ngbPopover]="popContentReservedCards" [popoverTitle]="popTitleReservedCards">
                        <h6 class="text-center">Held</h6>
                        <h6 class="text-center">{{getPlayers()[2].heldCards.length}}</h6>
                    </div>
                    <div class="col"></div>
                </div>

                <!-- Player buying power -->
                <div class="row justify-content-center"
                    [class.pointer]="(activePlayer == 2 && !getPlayers()[activePlayer].isAi) ? (turnAction == ACTION_EXCHANGE_GEMS || turnAction == ACTION_RESERVE_EXCHANGE || (turnAction == ACTION_BUY_CARD && gem == gemTypes[gemTypes.length - 1] && getPlayerGemsByGemType(2, gem) > 0)) : false"
                    *ngFor="let gem of gemTypes">
                    <div class="col">
                        <!-- Gem Title -->
                        <h6 class="text-center" [ngStyle]="getCostColor(gem[0])">{{gem.substring(0, 3)}}</h6>
                        <!-- Gem display -->
                        <h6 class="text-center" [ngStyle]="getCostColor(gem[0])"
                            (click)="(activePlayer == 2 && !getPlayers()[activePlayer].isAi) ? ((turnAction == ACTION_EXCHANGE_GEMS || turnAction == ACTION_RESERVE_EXCHANGE) ? exchangeGem(gem) : 
                    ((turnAction == ACTION_BUY_CARD && gem == gemTypes[gemTypes.length - 1] && getPlayerGemsByGemType(2, gem) > 0) ? startSpendingGold() : {})) : {}">
                            <!-- total -->
                            <div *ngIf="showBuyingPowerAsTotal">
                                {{getPlayerBuyingPowerByGemType(2, gem)}}
                            </div>
                            <!-- gem - card breakdown -->
                            <div *ngIf="!showBuyingPowerAsTotal">
                                {{getPlayerGemsByGemType(2, gem)}} -
                                {{getPlayerCardsByGemType(2, gem)}}
                            </div>
                        </h6>
                    </div>
                </div>

                <!-- Toggle Resource Details -->
                <div class="row justify-content-center">
                    <div [class.pointer]="activePlayer == 2 && !getPlayers()[activePlayer].isAi"
                        [class.text-muted]="showBuyingPowerAsTotal" [class.font-weight-light]="showBuyingPowerAsTotal"
                        (click)="(activePlayer == 2 && !getPlayers()[activePlayer].isAi) ? (showBuyingPowerAsTotal = !showBuyingPowerAsTotal) : {}">
                        Gems ({{getPlayerGemsTotal(2)}}) - Cards ({{getPlayerCardsTotal(2)}})
                    </div>
                </div>

            </div>

            <div class="col-1"></div>

            <div class="col">
                <!-- Nobles -->
                <section class="container" *ngIf="getNobles() && getNobles().length > 0">
                    <div class="row justify-content-around" style="height: 15vh;">
                        <ng-container *ngFor="let noble of getNobles()">
                            <div class="col-sm-2">
                                <div class="card bg-dark">
                                    <img class="card-img" style="object-fit: cover; height: 15vh;"
                                        src="../../../assets/noble.jpg" alt="noble">
                                    <div class="card-img-overlay">
                                        <div class="d-flex flex-column h-100 justify-content-between" *ngIf="noble">
                                            <div class="row justify-content-around bg-light">
                                                <h4 class="card-text">{{noble.points}}</h4>
                                                <h4></h4>
                                            </div>
                                            <div class="row justify-content-around bg-light">
                                                <h4 class="card-text text-center"
                                                    [ngStyle]="getCostColor(nobleCost.key[0])"
                                                    *ngFor="let nobleCost of noble.cost | keyvalue">
                                                    {{nobleCost.value}}</h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </section>
                <br>
                <!-- Tier 3 Cards -->
                <section class="container" *ngIf="getT3Deck() && getT3Showing()">
                    <div class="row justify-content-around" style="height: 15vh;">
                        <div class="col-sm-2">
                            <div class="card bg-success">
                                <img class="card-img" style="object-fit: cover; height: 15vh; opacity: .5;"
                                    src="../../../assets/t3gems.png" alt="t3">
                                <div class="card-img-overlay">
                                    <div class="d-flex flex-column h-100 justify-content-between">
                                        <div class="row justify-content-around bg-light">
                                            <h4>{{getT3Deck().length}}</h4>
                                        </div>
                                        <div class="row justify-content-around bg-light">
                                            <h4 class="card-text text-center">Tier 3</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <ng-container *ngFor="let card of getT3Showing(); let i = index">
                            <div class="col-sm-2"
                                (click)="activePlayer == playerId ? (activePlayerCanAffordCard(card) ? buyCard(card, i) : reserveCard(card, i)) : {}">
                                <div class="card bg-success" [class.pointer]="card && activePlayer == playerId"
                                    [ngStyle]=showAsSelected(card)>
                                    <img class="card-img" style="object-fit: cover; height: 15vh; opacity: .85;"
                                        src="../../../assets/t3gems.png" alt="t3">
                                    <div class="card-img-overlay">
                                        <div class="d-flex flex-column h-100 justify-content-between" *ngIf="card">
                                            <div class="row justify-content-around bg-light">
                                                <h4>{{card.points}}</h4>
                                                <h4>-</h4>
                                                <h4 [ngStyle]="getCostColor(card.value[0])">
                                                    1
                                                </h4>
                                            </div>
                                            <div class="row justify-content-around bg-light">
                                                <h4 class="card-text text-center"
                                                    [ngStyle]="getCostColor(cardCost.key[0])"
                                                    *ngFor="let cardCost of card.cost | keyvalue">{{cardCost.value}}
                                                </h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </section>
                <br>
                <!-- Tier 2 Cards -->
                <section class="container" *ngIf="getT2Deck() && getT2Showing()">
                    <div class="row justify-content-around" style="height: 15vh;">
                        <div class="col-sm-2">
                            <div class="card bg-warning">
                                <img class="card-img"
                                    style="object-fit: cover; height: 15vh; opacity: .5; background-color: white;"
                                    src="../../../assets/t2gems.svg" alt="t2">
                                <div class="card-img-overlay">
                                    <div class="d-flex flex-column h-100 justify-content-between">
                                        <div class="row justify-content-around bg-light">
                                            <h4>{{getT2Deck().length}}</h4>
                                        </div>
                                        <div class="row justify-content-around bg-light">
                                            <h4 class="card-text text-center">Tier 2</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <ng-container *ngFor="let card of getT2Showing(); let i = index">
                            <div class="col-sm-2"
                                (click)="activePlayer == playerId ? (activePlayerCanAffordCard(card) ? buyCard(card, i) : reserveCard(card, i)) : {}">
                                <div class="card bg-warning" [class.pointer]="card && activePlayer == playerId"
                                    [ngStyle]=showAsSelected(card)>
                                    <img class="card-img"
                                        style="object-fit: cover; height: 15vh; opacity: .85; background-color: white;"
                                        src="../../../assets/t2gems.svg" alt="t2">
                                    <div class="card-img-overlay">
                                        <div class="d-flex flex-column h-100 justify-content-between" *ngIf="card">
                                            <div class="row justify-content-around bg-light">
                                                <h4>{{card.points}}</h4>
                                                <h4>-</h4>
                                                <h4 [ngStyle]="getCostColor(card.value[0])">
                                                    1
                                                </h4>
                                            </div>
                                            <div class="row justify-content-around bg-light">
                                                <h4 class="card-text text-center"
                                                    [ngStyle]="getCostColor(cardCost.key[0])"
                                                    *ngFor="let cardCost of card.cost | keyvalue">{{cardCost.value}}
                                                </h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </section>
                <br>
                <!-- Tier 1 Cards -->
                <section class="container" *ngIf="getT1Deck() && getT1Showing()">
                    <div class="row justify-content-around" style="height: 15vh;">
                        <div class="col-sm-2">
                            <div class="card bg-primary">
                                <img class="card-img" style="object-fit: cover; height: 15vh; opacity: .5;"
                                    src="../../../assets/t1gem.png" alt="t1">
                                <div class="card-img-overlay">
                                    <div class="d-flex flex-column h-100 justify-content-between">
                                        <div class="row justify-content-around bg-light">
                                            <h4>{{getT1Deck().length}}</h4>
                                        </div>
                                        <div class="row justify-content-around bg-light">
                                            <h4 class="card-text text-center">Tier 1</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <ng-container *ngFor="let card of getT1Showing(); let i = index">
                            <div class="col-sm-2"
                                (click)="activePlayer == playerId ? (activePlayerCanAffordCard(card) ? buyCard(card, i) : reserveCard(card, i)) : {}">
                                <div class="card bg-primary" [class.pointer]="card && activePlayer == playerId"
                                    [ngStyle]=showAsSelected(card)>
                                    <img class="card-img" style="object-fit: cover; height: 15vh; opacity: .85;"
                                        src="../../../assets/t1gem.png" alt="t1">
                                    <div class="card-img-overlay">
                                        <div class="d-flex flex-column h-100 justify-content-between" *ngIf="card">
                                            <div class="row justify-content-around bg-light">
                                                <h4>{{card.points}}</h4>
                                                <h4>-</h4>
                                                <h4 [ngStyle]="getCostColor(card.value[0])">
                                                    1
                                                </h4>
                                            </div>
                                            <div class="row justify-content-around bg-light">
                                                <h4 class="card-text text-center"
                                                    [ngStyle]="getCostColor(cardCost.key[0])"
                                                    *ngFor="let cardCost of card.cost | keyvalue">{{cardCost.value}}
                                                </h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </section>
            </div>

            <div class="col-1"></div>
            <!-- Gem Bank -->
            <div class="col-1 d-flex flex-column justify-content-around border border-light">

                <div *ngFor="let gem of gemTypes">

                    <div class="card" [ngClass]=getGemColor(gem[0])
                        [class.pointer]="gem[0] !== 'G' && activePlayer == playerId"
                        (click)="activePlayer == playerId ? (gatherGem(gem)) : {}" [ngStyle]=showAsSelected(gem)>
                        <img class="card-img" style="object-fit: cover; height: 9vh; opacity: .5;"
                            src="../../../assets/t1gem.png" alt="{{gem}}">
                        <div class="card-img-overlay">
                            <div class="d-flex flex-column justify-content-center">
                                <div class="row justify-content-around bg-light">
                                    <h4 [ngStyle]="getCostColor(gem[0])">{{gem.substring(0, 3)}}</h4>
                                    <h4>{{getBankTokens().get(gem)}}</h4>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div class="col-1"></div>
            <!-- Player 4 -->
            <div class="col-1 d-flex flex-column bg-light justify-content-between" *ngIf="getNumberOfPlayers() >= 4"
                [ngStyle]="showAsSelected(3)">

                <div class="row justify-content-center">
                    {{getPlayers()[3].name}} (Computer)
                </div>

                <!-- Player points -->
                <div class="row justify-content-center">
                    <div class="col"></div>
                    <div class="col border-bottom border-secondary">
                        <h6 class="text-center">Points</h6>
                        <h6 class="text-center">{{getPlayers()[3].points}}</h6>
                    </div>
                    <div class="col"></div>
                </div>

                <!-- Held Cards -->
                <div class="row justify-content-center">
                    <ng-template #popTitleReservedCards>
                        <div class="text-center">Reserved Cards</div>
                    </ng-template>

                    <ng-template #popContentReservedCards>
                        <!-- Show Reserved Cards -->
                        <div *ngFor="let card of getPlayers()[3].heldCards; let i = index">
                            <div class="row">
                                <div class="col"></div>
                                <div class="col-8">
                                    <div class="card" [ngClass]=getTierCardColor(card)
                                        [class.pointer]="activePlayer == 3 && !getPlayers()[activePlayer].isAi"
                                        (click)="(activePlayer == 3 && !getPlayers()[activePlayer].isAi) ? (activePlayerCanAffordCard(card) ? buyCard(card) : showGempyreModal(this.ALERT_TYPE_USER_ERROR, this.ALERT_CAN_NOT_AFFORD_RESERVED_CARD)) : {}"
                                        [ngStyle]=showAsSelected(card)>
                                        <img class="card-img"
                                            style="object-fit: cover; height: 15vh; opacity: .85; background-color: white;"
                                            [src]=getTierCardImage(card.tier) alt="tier{{card.tier}}">
                                        <div class="card-img-overlay">
                                            <div class="d-flex flex-column h-100 justify-content-between" *ngIf="card">
                                                <div class="row justify-content-around bg-light">
                                                    <h4>{{card.points}}</h4>
                                                    <h4>-</h4>
                                                    <h4 [ngStyle]="getCostColor(card.value[0])">
                                                        1
                                                    </h4>
                                                </div>
                                                <div class="row justify-content-around bg-light">
                                                    <h4 class="card-text text-center"
                                                        [ngStyle]="getCostColor(cardCost.key[0])"
                                                        *ngFor="let cardCost of card.cost | keyvalue">
                                                        {{cardCost.value}}</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col"></div>
                            </div>
                            <br *ngIf="i + 1 < getPlayers()[3].heldCards.length">
                        </div>

                    </ng-template>

                    <div class="col"></div>
                    <div class="col border-bottom border-secondary pointer" id="heldCards" placement="left"
                        [ngbPopover]="popContentReservedCards" [popoverTitle]="popTitleReservedCards">
                        <h6 class="text-center">Held</h6>
                        <h6 class="text-center">{{getPlayers()[3].heldCards.length}}</h6>
                    </div>
                    <div class="col"></div>
                </div>

                <!-- Player buying power -->
                <div class="row justify-content-center"
                    [class.pointer]="(activePlayer == 3 && !getPlayers()[activePlayer].isAi) ? (turnAction == ACTION_EXCHANGE_GEMS || turnAction == ACTION_RESERVE_EXCHANGE || (turnAction == ACTION_BUY_CARD && gem == gemTypes[gemTypes.length - 1] && getPlayerGemsByGemType(3, gem) > 0)) : false"
                    *ngFor="let gem of gemTypes">
                    <div class="col">
                        <!-- Gem Title -->
                        <h6 class="text-center" [ngStyle]="getCostColor(gem[0])">{{gem.substring(0, 3)}}</h6>
                        <!-- Gem display -->
                        <h6 class="text-center" [ngStyle]="getCostColor(gem[0])"
                            (click)="(activePlayer == 3 && !getPlayers()[activePlayer].isAi) ? ((turnAction == ACTION_EXCHANGE_GEMS || turnAction == ACTION_RESERVE_EXCHANGE) ? exchangeGem(gem) : 
                    ((turnAction == ACTION_BUY_CARD && gem == gemTypes[gemTypes.length - 1] && getPlayerGemsByGemType(3, gem) > 0) ? startSpendingGold() : {})) : {}">
                            <!-- total -->
                            <div *ngIf="showBuyingPowerAsTotal">
                                {{getPlayerBuyingPowerByGemType(3, gem)}}
                            </div>
                            <!-- gem - card breakdown -->
                            <div *ngIf="!showBuyingPowerAsTotal">
                                {{getPlayerGemsByGemType(3, gem)}} -
                                {{getPlayerCardsByGemType(3, gem)}}
                            </div>
                        </h6>
                    </div>
                </div>

                <!-- Toggle Resource Details -->
                <div class="row justify-content-center">
                    <div [class.pointer]="activePlayer == 3 && !getPlayers()[activePlayer].isAi"
                        [class.text-muted]="showBuyingPowerAsTotal" [class.font-weight-light]="showBuyingPowerAsTotal"
                        (click)="(activePlayer == 3 && !getPlayers()[activePlayer].isAi) ? (showBuyingPowerAsTotal = !showBuyingPowerAsTotal) : {}">
                        Gems ({{getPlayerGemsTotal(3)}}) - Cards ({{getPlayerCardsTotal(3)}})
                    </div>
                </div>

            </div>

        </div>

        <br>

        <div class="row align-items-center">
            <div class="col">
                <!-- Turn Action -->
                <div class="row justify-content-center">

                    <ng-template #popTitle>
                        <!-- No need to show clear action option -->
                        <div class="text-center" *ngIf="turnAction == ACTION_NONE">
                            {{turnAction}}
                        </div>
                        <!-- Show clear action option -->
                        <div class="row" *ngIf="turnAction != ACTION_NONE">
                            <div class="col"></div>
                            <div class="col-6">
                                <div class="row justify-content-around">
                                    <div class="text-center">
                                        {{turnAction}}
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="row justify-content-end">
                                    <div class="text-center text-muted font-weight-light"
                                        [class.pointer]="activePlayer == playerId"
                                        (click)="activePlayer == playerId ? (clearTurnAction()) : {}">
                                        Clear &nbsp;
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-template>

                    <ng-template #popContent>
                        <!-- Gathering Gems -->
                        <div *ngIf="turnAction == ACTION_GATHER_GEMS">
                            <div *ngFor="let gem of gatheredGems; let i = index">
                                <div class="row">
                                    <div class="col"></div>
                                    <div class="col-8">
                                        <div class="card" [class.pointer]="activePlayer == playerId"
                                            [ngClass]=getGemColor(gem[0])
                                            (click)="activePlayer == playerId ? (returnGem(gem)) : {}">
                                            <img class="card-img" style="object-fit: cover; height: 9vh; opacity: .5;"
                                                src="../../../assets/t1gem.png" alt="{{gem}}">
                                            <div class="card-img-overlay">
                                                <div class="d-flex flex-column justify-content-center">
                                                    <div class="row justify-content-around bg-light">
                                                        <h4 [ngStyle]="getCostColor(gem[0])">{{gem.substring(0, 3)}}
                                                        </h4>
                                                        <h4>1</h4>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col"></div>
                                </div>
                                <br *ngIf="i + 1 < gatheredGems.length">
                            </div>
                        </div>

                        <!-- Buying a card -->
                        <div *ngIf="turnAction == ACTION_BUY_CARD">

                            <div class="row">
                                <div class="col"></div>
                                <div class="col-8">
                                    <div class="card" [class.pointer]="activePlayer == playerId"
                                        [ngClass]=getTierCardColor(buyingCard)
                                        (click)="activePlayer == playerId ? (returnBuyingCard()) : {}">
                                        <img class="card-img"
                                            style="object-fit: cover; height: 15vh; opacity: .85; background-color: white;"
                                            [src]=getTierCardImage(buyingCard.tier) alt="tier{{buyingCard.tier}}">
                                        <div class="card-img-overlay">
                                            <div class="d-flex flex-column h-100 justify-content-between"
                                                *ngIf="buyingCard">
                                                <div class="row justify-content-around bg-light">
                                                    <h4>{{buyingCard.points}}</h4>
                                                    <h4>-</h4>
                                                    <h4 [ngStyle]="getCostColor(buyingCard.value[0])">
                                                        1
                                                    </h4>
                                                </div>
                                                <div class="row justify-content-around bg-light">
                                                    <h4 class="card-text text-center"
                                                        [ngStyle]="getCostColor(cardCost.key[0])"
                                                        *ngFor="let cardCost of buyingCard.cost | keyvalue">
                                                        {{cardCost.value}}</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col"></div>
                            </div>

                            <!-- Spending Gold -->
                            <div *ngIf="spendingGold.length > 0">
                                <hr class="mb-1 mt-2">
                                <div class="row mb-2">
                                    <div class="col"></div>
                                    <div class="col-6">
                                        <div class="text-center text-nowrap mb-1 border-secondary border-bottom">
                                            Spending Gold As..
                                        </div>
                                    </div>
                                    <div class="col"></div>
                                </div>
                                <div *ngFor="let gem of spendingGold; let i = index">
                                    <div class="row">
                                        <div class="col"></div>
                                        <div class="col-8">
                                            <div class="card" [class.pointer]="activePlayer == playerId"
                                                [ngClass]=getGemColor(gem[0])
                                                (click)="activePlayer == playerId ? (returnGoldSpentAsGem(gem)) : {}">
                                                <img class="card-img"
                                                    style="object-fit: cover; height: 9vh; opacity: .5;"
                                                    src="../../../assets/t1gem.png" alt="{{gem}}">
                                                <div class="card-img-overlay">
                                                    <div class="d-flex flex-column justify-content-center">
                                                        <div class="row justify-content-around bg-light">
                                                            <h4 [ngStyle]="getCostColor(gem[0])">{{gem.substring(0, 3)}}
                                                            </h4>
                                                            <h4>1</h4>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col"></div>
                                    </div>
                                    <br *ngIf="i + 1 < spendingGold.length">
                                </div>
                            </div>

                        </div>

                        <!-- Reserving a card -->
                        <div *ngIf="turnAction == ACTION_RESERVE_CARD || turnAction == ACTION_RESERVE_EXCHANGE">

                            <div class="row">
                                <div class="col"></div>
                                <div class="col-8">
                                    <div class="card" [class.pointer]="activePlayer == playerId"
                                        [ngClass]=getTierCardColor(reservingCard)
                                        (click)="activePlayer == playerId ? (clearTurnAction()) : {}">
                                        <img class="card-img"
                                            style="object-fit: cover; height: 15vh; opacity: .85; background-color: white;"
                                            [src]=getTierCardImage(reservingCard.tier) alt="tier{{reservingCard.tier}}">
                                        <div class="card-img-overlay">
                                            <div class="d-flex flex-column h-100 justify-content-between"
                                                *ngIf="reservingCard">
                                                <div class="row justify-content-around bg-light">
                                                    <h4>{{reservingCard.points}}</h4>
                                                    <h4>-</h4>
                                                    <h4 [ngStyle]="getCostColor(reservingCard.value[0])">
                                                        1
                                                    </h4>
                                                </div>
                                                <div class="row justify-content-around bg-light">
                                                    <h4 class="card-text text-center"
                                                        [ngStyle]="getCostColor(cardCost.key[0])"
                                                        *ngFor="let cardCost of reservingCard.cost | keyvalue">
                                                        {{cardCost.value}}</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col"></div>
                            </div>

                            <!-- Gathered Gold -->
                            <div *ngIf="gatheredGems.length > 0 && turnAction == ACTION_RESERVE_CARD">
                                <hr class="mb-1 mt-2">
                                <div class="row mb-2">
                                    <div class="col"></div>
                                    <div class="col-6">
                                        <div class="text-center mb-1 border-secondary border-bottom">
                                            Gaining Gems
                                        </div>
                                    </div>
                                    <div class="col"></div>
                                </div>
                                <div *ngFor="let gem of gatheredGems; let i = index">
                                    <div class="row">
                                        <div class="col"></div>
                                        <div class="col-8">
                                            <div class="card" [ngClass]=getGemColor(gem[0])>
                                                <img class="card-img"
                                                    style="object-fit: cover; height: 9vh; opacity: .5;"
                                                    src="../../../assets/t1gem.png" alt="{{gem}}">
                                                <div class="card-img-overlay">
                                                    <div class="d-flex flex-column justify-content-center">
                                                        <div class="row justify-content-around bg-light">
                                                            <h4 [ngStyle]="getCostColor(gem[0])">{{gem.substring(0, 3)}}
                                                            </h4>
                                                            <h4>1</h4>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col"></div>
                                    </div>
                                    <br *ngIf="i + 1 < gatheredGems.length">
                                </div>
                            </div>

                        </div>

                        <!-- Exchanging Gems -->
                        <div *ngIf="turnAction == ACTION_EXCHANGE_GEMS || turnAction == ACTION_RESERVE_EXCHANGE">
                            <hr class="mb-1 mt-2" *ngIf="turnAction == ACTION_RESERVE_EXCHANGE">
                            <!-- Gathered Gems -->
                            <div class="row mb-2">
                                <div class="col"></div>
                                <div class="col-6">
                                    <div class="text-center mb-1 border-secondary border-bottom">
                                        Gaining Gems
                                    </div>
                                </div>
                                <div class="col"></div>
                            </div>
                            <div *ngFor="let gem of gatheredGems; let i = index">
                                <div class="row">
                                    <div class="col"></div>
                                    <div class="col-8">
                                        <div class="card"
                                            [class.pointer]="activePlayer == playerId && gem != gemTypes[gemTypes.length - 1]"
                                            [ngClass]=getGemColor(gem[0])
                                            (click)="(activePlayer == playerId && gem != gemTypes[gemTypes.length - 1]) ? (returnGem(gem)) : {}">
                                            <img class="card-img" style="object-fit: cover; height: 9vh; opacity: .5;"
                                                src="../../../assets/t1gem.png" alt="{{gem}}">
                                            <div class="card-img-overlay">
                                                <div class="d-flex flex-column justify-content-center">
                                                    <div class="row justify-content-around bg-light">
                                                        <h4 [ngStyle]="getCostColor(gem[0])">{{gem.substring(0, 3)}}
                                                        </h4>
                                                        <h4>1</h4>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col"></div>
                                </div>
                                <br *ngIf="i + 1 < gatheredGems.length">
                            </div>
                            <hr class="mb-1 mt-2">
                            <!-- Exchanging Gems -->
                            <div class="row mb-2">
                                <div class="col"></div>
                                <div class="col-6">
                                    <div class="text-center mb-1 border-secondary border-bottom">
                                        Returning Gems
                                    </div>
                                </div>
                                <div class="col"></div>
                            </div>
                            <div *ngFor="let gem of exchangingGems; let i = index">
                                <div class="row">
                                    <div class="col"></div>
                                    <div class="col-8">
                                        <div class="card" [class.pointer]="activePlayer == playerId"
                                            [ngClass]=getGemColor(gem[0])
                                            (click)="activePlayer == playerId ? (returnExchangingGem(gem)) : {}">
                                            <img class="card-img" style="object-fit: cover; height: 9vh; opacity: .5;"
                                                src="../../../assets/t1gem.png" alt="{{gem}}">
                                            <div class="card-img-overlay">
                                                <div class="d-flex flex-column justify-content-center">
                                                    <div class="row justify-content-around bg-light">
                                                        <h4 [ngStyle]="getCostColor(gem[0])">{{gem.substring(0, 3)}}
                                                        </h4>
                                                        <h4>1</h4>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col"></div>
                                </div>
                                <br *ngIf="i + 1 < exchangingGems.length">
                            </div>
                        </div>

                    </ng-template>

                    <button type="button" class="btn btn-light" id="turnActionButton" placement="top"
                        [ngbPopover]="popContent" [popoverTitle]="popTitle" [autoClose]="false" (click)="p != undefined ? p.toggle() : {}">
                        Turn Action
                    </button>

                </div>
            </div>
            <div class="col-1"></div>
            <!-- Player 1 -->
            <div class="col-4 bg-light" style="height: 9vh;" [ngStyle]="showAsSelected(0)">
                <div class="row justify-content-around">
                    <div class="col"></div>
                    <div class="col">
                        <!-- Player Name -->
                        <div class="row justify-content-around">
                            {{getPlayers()[0].name}} (You)
                        </div>
                    </div>
                    <div class="col">
                        <!-- Toggle Resource Details -->
                        <div class="row justify-content-end">
                            <div [class.pointer]="playerId == 0 && !getPlayers()[playerId].isAi"
                                [class.text-muted]="showBuyingPowerAsTotal"
                                [class.font-weight-light]="showBuyingPowerAsTotal"
                                (click)="(playerId == 0 && !getPlayers()[playerId].isAi) ? (showBuyingPowerAsTotal = !showBuyingPowerAsTotal) : {}">
                                Gems ({{getPlayerGemsTotal(0)}}) - Cards ({{getPlayerCardsTotal(0)}}) &nbsp;
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row justify-content-around">
                    <!-- Player points -->
                    <div class="col border-right border-secondary">
                        <h6 class="text-center">Points</h6>
                        <h6 class="text-center">{{getPlayers()[0].points}}</h6>
                    </div>

                    <!-- Held Cards -->

                    <ng-template #popTitleReservedCards>
                        <div class="text-center">Reserved Cards</div>
                    </ng-template>

                    <ng-template #popContentReservedCards>
                        <!-- Show Reserved Cards -->
                        <div *ngFor="let card of getPlayers()[0].heldCards; let i = index">
                            <div class="row">
                                <div class="col"></div>
                                <div class="col-8">
                                    <div class="card" [ngClass]=getTierCardColor(card)
                                        [class.pointer]="activePlayer == 0 && !getPlayers()[activePlayer].isAi"
                                        (click)="(activePlayer == 0 && !getPlayers()[activePlayer].isAi) ? (activePlayerCanAffordCard(card) ? buyCard(card) : showGempyreModal(this.ALERT_TYPE_USER_ERROR, this.ALERT_CAN_NOT_AFFORD_RESERVED_CARD)) : {}"
                                        [ngStyle]=showAsSelected(card)>
                                        <img class="card-img"
                                            style="object-fit: cover; height: 15vh; opacity: .85; background-color: white;"
                                            [src]=getTierCardImage(card.tier) alt="tier{{card.tier}}">
                                        <div class="card-img-overlay">
                                            <div class="d-flex flex-column h-100 justify-content-between" *ngIf="card">
                                                <div class="row justify-content-around bg-light">
                                                    <h4>{{card.points}}</h4>
                                                    <h4>-</h4>
                                                    <h4 [ngStyle]="getCostColor(card.value[0])">
                                                        1
                                                    </h4>
                                                </div>
                                                <div class="row justify-content-around bg-light">
                                                    <h4 class="card-text text-center"
                                                        [ngStyle]="getCostColor(cardCost.key[0])"
                                                        *ngFor="let cardCost of card.cost | keyvalue">
                                                        {{cardCost.value}}</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col"></div>
                            </div>
                            <br *ngIf="i + 1 < getPlayers()[0].heldCards.length">
                        </div>

                    </ng-template>

                    <div class="col border-right border-secondary pointer" id="heldCards" placement="top"
                        [ngbPopover]="popContentReservedCards" [popoverTitle]="popTitleReservedCards">
                        <h6 class="text-center">Held</h6>
                        <h6 class="text-center">{{getPlayers()[0].heldCards.length}}</h6>

                    </div>
                    <!-- Player buying power -->
                    <div class="col"
                        [class.pointer]="(activePlayer == 0 && !getPlayers()[activePlayer].isAi) ? (turnAction == ACTION_EXCHANGE_GEMS || turnAction == ACTION_RESERVE_EXCHANGE || (turnAction == ACTION_BUY_CARD && gem == gemTypes[gemTypes.length - 1] && getPlayerGemsByGemType(0, gem) > 0)) : false"
                        *ngFor="let gem of gemTypes">
                        <!-- Gem Title -->
                        <h6 class="text-center" [ngStyle]="getCostColor(gem[0])">{{gem.substring(0, 3)}}</h6>
                        <!-- Gem display -->
                        <h6 class="text-center" [ngStyle]="getCostColor(gem[0])"
                            (click)="(activePlayer == 0 && !getPlayers()[activePlayer].isAi) ? ((turnAction == ACTION_EXCHANGE_GEMS || turnAction == ACTION_RESERVE_EXCHANGE) ? exchangeGem(gem) : 
                        ((turnAction == ACTION_BUY_CARD && gem == gemTypes[gemTypes.length - 1] && getPlayerGemsByGemType(0, gem) > 0) ? startSpendingGold() : {})) : {}">
                            <!-- total -->
                            <div *ngIf="showBuyingPowerAsTotal">
                                {{getPlayerBuyingPowerByGemType(0, gem)}}
                            </div>
                            <!-- gem - card breakdown -->
                            <div *ngIf="!showBuyingPowerAsTotal">
                                {{getPlayerGemsByGemType(0, gem)}} -
                                {{getPlayerCardsByGemType(0, gem)}}
                            </div>
                        </h6>
                    </div>
                </div>

            </div>
            <div class="col-1"></div>
            <!-- End Turn -->
            <div class="col">
                <div class="row justify-content-center">
                    <button type="button" class="btn btn-light" (click)="activePlayer == playerId ? (endTurn()) : {}"
                        [disabled]="activePlayer != playerId">
                        End Turn
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Button trigger modal -->
<button type="button" id="gempyreModalButton" class="btn" data-toggle="modal" data-target="#gempyreModal"
    style="display: none;"></button>

<!-- Modal -->
<div class="modal fade" [ngStyle]="getModalBackdropColor()" id="gempyreModal" tabindex="-1"
    aria-labelledby="gempyreModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="gempyreModalLabel">{{alertType}}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                {{alert}}
            </div>
            <!-- footer spending gold -->
            <div class="modal-footer"
                *ngIf="alertType == ALERT_TYPE_EXCHANGE && alert == ALERT_SPEND_GOLD && turnAction == ACTION_BUY_CARD">
                <!-- Cost on Buying Card -->
                <div class="container-fluid">
                    <div class="row">
                        <div class="col" *ngFor="let cost of buyingCard.cost | keyvalue">
                            <div class="card" [class.pointer]="activePlayer == playerId"
                                [ngClass]=getGemColor(cost.key[0])
                                (click)="activePlayer == playerId ? (spendGoldAsGem(cost.key)) : {}"
                                data-dismiss="modal">
                                <img class="card-img" style="object-fit: cover; height: 9vh; opacity: .5;"
                                    src="../../../assets/t1gem.png" alt="{{cost.key}}">
                                <div class="card-img-overlay">
                                    <div class="d-flex flex-column justify-content-center">
                                        <div class="row justify-content-around bg-light">
                                            <h4 [ngStyle]="getCostColor(cost.key[0])">{{cost.key.substring(0, 3)}}
                                            </h4>
                                            <h4>1</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- footer for non-reserve actions -->
            <div class="modal-footer"
                *ngIf="alertType != ALERT_TYPE_RESERVE && alert != ALERT_CAN_NOT_AFFORD_RESERVED_CARD && alert != ALERT_MUST_TAKE_TURN_ACTION">
                <!-- Yes button for exchange gems -->
                <button type="button" class="btn btn-secondary col"
                    (click)="activePlayer == playerId ? (startGemExchange()) : {}"
                    *ngIf="alert == ALERT_MAX_GEMS">Yes</button>
                <div class="col"></div>
                <!-- No Button for exchange gems -->
                <button type="button" class="btn btn-secondary col" data-dismiss="modal" *ngIf="alert == ALERT_MAX_GEMS"
                    (click)="activePlayer == playerId ? (clearTurnAction()) : {}">No</button>
                <div class="col"></div>
                <!-- View Turn Action button -->
                <button type="button" class="btn btn-secondary" data-dismiss="modal"
                    (click)="activePlayer == playerId ? (showTurnAction()) : {}">View
                    Turn Action</button>
            </div>
            <!-- footer for reserve action -->
            <div class="modal-footer" *ngIf="alertType == ALERT_TYPE_RESERVE">
                <!-- Yes for reserve card initially -->
                <button type="button" class="btn btn-secondary col"
                    (click)="activePlayer == playerId ? (confirmReserveCard()) : {}"
                    *ngIf="alert == ALERT_RESERVE_CARD">Yes</button>
                <!-- Yes for reserve card if no gold is available -->
                <button type="button" class="btn btn-secondary col" data-dismiss="modal"
                    (click)="activePlayer == playerId ? (updateReservingCard()) : {}"
                    *ngIf="alert == ALERT_NO_GOLD_IN_BANK">Yes</button>
                <!-- Yes for reserve card if at max gems -->
                <button type="button" class="btn btn-secondary col"
                    (click)="activePlayer == playerId ? (startExchangeGemForGold()) : {}"
                    *ngIf="alert == ALERT_RESERVE_WITH_MAX_GEMS">Yes</button>
                <div class="col"></div>
                <button type="button" class="btn btn-secondary col" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>